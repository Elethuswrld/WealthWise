{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the WealthWise application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "currency": {
          "type": "string",
          "description": "The user's preferred currency (e.g., 'ZAR', 'USD')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "currency",
        "createdAt"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Transaction)"
        },
        "type": {
          "type": "string",
          "description": "The type of transaction (e.g., 'income', 'expense', 'investment')."
        },
        "category": {
          "type": "string",
          "description": "The category of the transaction (e.g., 'Forex', 'Crypto', 'Food')."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        },
        "date": {
          "type": "string",
          "description": "The date of the transaction.",
          "format": "date-time"
        },
        "notes": {
          "type": "string",
          "description": "Any notes or comments about the transaction."
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "category",
        "amount",
        "date"
      ]
    },
    "PortfolioAsset": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PortfolioAsset",
      "type": "object",
      "description": "Represents an asset in a user's investment portfolio.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the portfolio asset entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N PortfolioAsset)"
        },
        "assetType": {
          "type": "string",
          "description": "The type of asset (e.g., 'Forex', 'Crypto', 'Stock')."
        },
        "assetName": {
          "type": "string",
          "description": "The name of the asset (e.g., 'EURUSD', 'Bitcoin', 'Apple')."
        },
        "investedAmount": {
          "type": "number",
          "description": "The amount initially invested in the asset."
        },
        "currentValue": {
          "type": "number",
          "description": "The current value of the asset."
        }
      },
      "required": [
        "id",
        "userId",
        "assetType",
        "assetName",
        "investedAmount",
        "currentValue"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Only the user can read/write their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transaction data for a specific user. Only the user can read/write their own transactions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/portfolio/{assetId}",
        "definition": {
          "entityName": "PortfolioAsset",
          "schema": {
            "$ref": "#/backend/entities/PortfolioAsset"
          },
          "description": "Stores portfolio asset data for a specific user. Only the user can read/write their own portfolio assets.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "assetId",
              "description": "The unique identifier of the portfolio asset."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to address the 'permission-denied' error and ensure a secure, scalable, and easily debuggable financial dashboard application ('WealthWise').\n\nAuthorization Independence (CRITICAL): The structure avoids hierarchical authorization dependencies by denormalizing authorization data. All authorization decisions rely solely on `request.auth.uid`.\n\n*   Transactions and PortfolioAssets are stored as subcollections under the `/users/{userId}` path. This implicitly grants the user ownership over these documents, eliminating the need for `get()` calls to verify ownership.\n\nClarity of Intent (Debuggability): The structure explicitly represents ownership through path-based access control (`/users/{userId}/transactions/{transactionId}`). This structure makes the authorization intent immediately clear.\n\nDBAC (No Custom Claims): User roles are not managed. Authorization relies solely on `request.auth.uid`.\n\nQAPs (Rules are not Filters): The design supports secure `list` operations by enforcing consistent security rules across all documents within a collection. Because transaction and portfolio asset data for other users aren't stored in the same collection as one user, it's impossible for a malicious user to list other user's private information.\n\nInvariants: The structure supports data integrity by enforcing ownership via path-based access. Timestamps (e.g., `createdAt` in `User`) are also supported.\n\nStructural Segregation:\n*   User data is stored in `/users/{userId}`, ensuring that all documents in the `users` collection have the same access requirements (only the user themselves can read/write their data).\n*   Transactions and portfolio assets are stored as subcollections under each user's document (`/users/{userId}/transactions/{transactionId}` and `/users/{userId}/portfolio/{assetId}`). This segregates transaction data, ensuring that only the owning user can access their own transaction data.\n\nAccess Modeling:\n*   Private Data: Path-based ownership is used for user data (`/users/{userId}`).\n*   User-Owned Data: Hierarchical paths are used for transactions and portfolio assets (`/users/{userId}/transactions/{transactionId}` and `/users/{userId}/portfolio/{assetId}`).\n\nData Clarity and Predictability:\n*   Explicit State Modeling: The application uses explicit fields like `type` (in Transaction) to represent state, avoiding implicit state derived from multiple fields.\n*   Predictable Schema: The schema avoids dynamic keys.\n*   Radical Consistency: Naming conventions are standardized (e.g., `userId` for user references)."
  }
}